<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Mera Photo Album</title>
<style>
:root{--primary:#5b8def;--accent:#7dd3fc;--card:#fff;--radius:18px;}
*{box-sizing:border-box;}
body{margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial;background:linear-gradient(180deg,#f4f8ff 0%,#fff 100%);padding:16px;min-height:100vh;display:flex;flex-direction:column;gap:16px;}
.page{max-width:1100px;margin:0 auto;width:100%;display:flex;flex-direction:column;gap:16px;}
header.app-header{background:linear-gradient(135deg,var(--primary),var(--accent));color:white;padding:14px 18px;border-radius:var(--radius);display:flex;justify-content:space-between;align-items:center;}
.brand{display:flex;align-items:center;gap:12px;}
.logo{height:44px;width:44px;border-radius:10px;background:rgba(255,255,255,0.18);display:grid;place-items:center;font-weight:700;}
.site-title{font-weight:600;}
.actions{display:flex;align-items:center;gap:10px;}
.cart-btn{background:rgba(255,255,255,0.14);color:white;border:0;padding:8px 12px;border-radius:12px;display:flex;align-items:center;gap:8px;cursor:pointer;}
.cart-badge{background:#ff5a5f;color:white;font-size:12px;padding:3px 7px;border-radius:999px;text-align:center;}
main.content{background:var(--card);padding:18px;border-radius:12px;box-shadow:0 10px 40px rgba(2,6,23,0.03);}
.product-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:16px;margin-top:20px;}
.product{background:#fff;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,0.08);overflow:hidden;display:flex;flex-direction:column;cursor:pointer;transition:transform 0.2s;}
.product:hover{transform:translateY(-2px);}
.product img{width:100%;height:160px;object-fit:cover;}
.product-info{padding:10px 12px;flex:1;}
.product h3{font-size:14px;margin:0 0 4px 0;}
.add-btn{background:linear-gradient(135deg,#5b8def,#7dd3fc);color:white;border:none;padding:6px 10px;border-radius:10px;font-weight:600;cursor:pointer;width:100%;transition:0.2s;}
.add-btn:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(91,141,239,0.3);}
footer.app-footer{background:var(--card);padding:14px 18px;border-radius:12px;box-shadow:0 6px 16px rgba(2,6,23,0.04);display:flex;flex-direction:column;align-items:center;font-size:14px;gap:6px;}
.cart-sidebar{position:fixed;top:0;right:-100%;width:85%;max-width:360px;height:100%;background:var(--card);box-shadow:-4px 0 12px rgba(0,0,0,0.2);transition:right 0.3s ease;padding:20px;display:flex;flex-direction:column;gap:12px;z-index:20;}
.cart-sidebar.open{right:0;}
.cart-item{display:flex;justify-content:space-between;align-items:center;gap:8px;flex-wrap:wrap;}
.cart-item button{background:var(--primary);color:#fff;border:none;padding:4px 8px;border-radius:6px;cursor:pointer;}
.cart-header{font-weight:600;font-size:18px;margin-bottom:12px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:6px;}
.clear-cart{background:#ff5a5f;padding:4px 8px;border-radius:6px;color:white;border:none;cursor:pointer;}
#addedPopup{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#5b8def;color:white;padding:16px 24px;border-radius:12px;display:none;align-items:center;gap:12px;z-index:50;box-shadow:0 4px 20px rgba(0,0,0,0.3);}
#addedPopup span{flex:1;}
.close-cart{align-self:flex-end;background:linear-gradient(135deg,#ff5a5f,#ff7b72);padding:10px 16px;border-radius:12px;border:none;cursor:pointer;color:white;font-weight:600;}
</style>
</head>
<body>
<div class="page">
<header class="app-header">
<div class="brand">
<div class="logo">IM</div>
<div><div class="site-title">MY STORE</div></div>
</div>
<div class="actions">
<button class="cart-btn" id="cartBtn">
<span>Cart</span><span class="cart-badge" id="cartCount">0</span>
</button>
</div>
</header>

<main class="content">
<div class="product-grid" id="productGrid"></div>
</main>

<footer class="app-footer">
<div>Â© 2025 Mera Photo Album</div>
<div>Responsive Layout with Cart</div>
</footer>
</div>

<div class="cart-sidebar" id="cartSidebar">
<div class="cart-header">
<span>Your Cart</span>
<button class="clear-cart" onclick="clearCart()">Clear Cart</button>
</div>
<div id="cartItems"></div>
<button onclick="sendOrderWhatsApp()" style="margin-top:10px;background:#25D366;color:#fff;padding:8px 12px;border-radius:8px;border:none;cursor:pointer;">Send via WhatsApp</button>
<button class="close-cart" onclick="toggleCart()">Close</button>
</div>

<div id="addedPopup"><span id="popupText">Product Added to Cart</span></div>

<script>
let products=[], cart={};
const cartCount=document.getElementById('cartCount');
const cartSidebar=document.getElementById('cartSidebar');
const cartItemsDiv=document.getElementById('cartItems');
const grid=document.getElementById('productGrid');
const addedPopup=document.getElementById('addedPopup');

const scriptURL="YOUR_GOOGLE_APPS_SCRIPT_URL_HERE";

document.getElementById('cartBtn').addEventListener('click', toggleCart);
function toggleCart(){cartSidebar.classList.toggle('open');}

fetch(scriptURL)
.then(r=>r.json())
.then(data=>{
  products = data.map(p=>{
    let img=p.image;
    if(img.includes("drive.google.com")){
      const match = img.match(/\/d\/(.+?)\//);
      if(match) img=`https://drive.google.com/uc?export=view&id=${match[1]}`;
      p.image=img;
    }
    return p;
  });
  renderProducts();
}).catch(err=>console.error(err));

function renderProducts(){
  grid.innerHTML="";
  products.forEach(p=>{
    const card=document.createElement('div');
    card.className='product';
    card.innerHTML=`
      <img src="${p.image}" alt="${p.name}">
      <div class="product-info">
        <h3>${p.name} - â‚¹${p.price}</h3>
        <div class="btn-area" id="btn-${p.Timestamp}">
          <button class="add-btn" onclick="addToCart('${p.Timestamp}',event)">Add to Cart</button>
        </div>
      </div>`;
    card.addEventListener('click',e=>{
      if(e.target.tagName!=='BUTTON') openPopup(p);
    });
    grid.appendChild(card);
  });
}

function addToCart(id,e){
  e.stopPropagation();
  if(cart[id]) return;
  cart[id]=1;
  updateCart();
  const btn=document.querySelector(`#btn-${id} button`);
  btn.textContent='Open Cart';
  btn.onclick=toggleCart;
  showAddedPopup("Product Added to Cart");
}

function updateCart(){
  updateCartCount();
  renderCartItems();
}

function updateCartCount(){
  const total=Object.values(cart).reduce((a,b)=>a+b,0);
  cartCount.textContent=total;
}

function renderCartItems(){
  cartItemsDiv.innerHTML='';
  for(let id in cart){
    const p=products.find(x=>x.Timestamp==id);
    const div=document.createElement('div');
    div.className='cart-item';
    div.innerHTML=`
      <span>${p.name}</span>
      <div>
        <button onclick="changeQty('${id}',-1)">-</button>
        <span>${cart[id]}</span>
        <button onclick="changeQty('${id}',1)">+</button>
      </div>`;
    cartItemsDiv.appendChild(div);
  }
}

function changeQty(id,delta){
  cart[id]+=delta;
  if(cart[id]<=0){
    delete cart[id];
    const btn = document.querySelector(`#btn-${id} button`);
    btn.textContent='Add to Cart';
    btn.onclick=(e)=>addToCart(id,e);
  }
  updateCart();
}

function clearCart(){
  cart={};
  updateCart();
  products.forEach(p=>{
    const btn=document.querySelector(`#btn-${p.Timestamp} button`);
    if(btn){btn.textContent='Add to Cart'; btn.onclick=(e)=>addToCart(p.Timestamp,e);}
  });
}

function sendOrderWhatsApp(){
  if(Object.keys(cart).length===0) return alert("Cart empty!");
  let text="ðŸ›’ Order Details:\n";
  let total=0;
  for(let id in cart){
    const p=products.find(x=>x.Timestamp==id);
    const qty=cart[id];
    text+=`${p.name} x ${qty} = â‚¹${p.price*qty}\n`;
    total+=p.price*qty;
  }
  text+="Total: â‚¹"+total;
  const whatsappURL=`https://wa.me/9518843849?text=${encodeURIComponent(text)}`;
  window.open(whatsappURL,"_blank");
}

// Popup
const popup=document.createElement('div');
popup.style.display='none';
popup.style.position='fixed';
popup.style.top=0;popup.style.left=0;popup.style.right=0;popup.style.bottom=0;
popup.style.background='rgba(0,0,0,0.6)';
popup.style.justifyContent='center';
popup.style.alignItems='center';
popup.style.zIndex=30;
popup.innerHTML=`
<div style='background:#fff;padding:20px;border-radius:12px;max-width:400px;width:90%;text-align:center;'>
<img id='popupImg' src='' style='width:100%;border-radius:8px;margin-bottom:10px;'/>
<h3 id='popupTitle'></h3>
<p id='popupDesc'></p>
<button onclick='closePopup()' style='margin-top:10px;background:#ff5a5f;padding:6px 12px;border-radius:8px;border:none;color:white;'>Close</button>
</div>`;
document.body.appendChild(popup);

function openPopup(p){
  document.getElementById('popupImg').src=p.image;
  document.getElementById('popupTitle').innerText=p.name;
  document.getElementById('popupDesc').innerText=p.description;
  popup.style.display='flex';
}
function closePopup(){popup.style.display='none';}

function showAddedPopup(msg){
  document.getElementById('popupText').innerText=msg;
  addedPopup.style.display='flex';
  document.body.style.pointerEvents='none';
  addedPopup.style.pointerEvents='auto';
  setTimeout(()=>{
    addedPopup.style.display='none';
    document.body.style.pointerEvents='auto';
  },1000);
}
</script>
</body>
</html>
